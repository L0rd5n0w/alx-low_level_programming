urgh. more functions nested loops
